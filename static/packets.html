<!DOCTYPE html>
<html lang=en>
<title>FYT Bus Packet Generator</title>
<meta charset="UTF-8">
<link rel="icon" href="/favicon.ico">
<link rel="stylesheet" href="/ui-stylesheet.css">

<header>
<h1>FYT Bus Packet Generator</h1>
<ul>
<li><a href="/">Home</a></li>
<li><a href="/packets">Packets</a></li>
<li><a href="/trips">Trips</a></li>
<li><a href="/directions">Directions</a></li>
</ul>
</header>

<main>
<h2>Regenerate packets</h2>
<p>
When you create a packet, that packet is saved as-is. Even you change the number of students on a trip, packets previous created with that trip on it before reflect the old value.

<p>
Clicking this button will regenerate the existing packets. The primary reason to do this is if the trips have changed since the packets were created, but it will also update any new special instructions.

<p>
<button id=regenerate onclick="regeneratePackets()">Regenerate</button>

<h2 id=packets-header>Existing packets</h2>
</main>

<footer><span>
Questions? Email <a href="mailto:Alexander.W.Petros@dartmouth.edu">Alexander.W.Petros@dartmouth.edu</a>
</span><span>
Source on <a href="https://github.com/dartmouth-outing-club/fyt-bus-packet-generator">Github</a></span></footer>

<script>
const WINDOW_URL = new URL(window.location.href)

// Populate existing packets from the backend, then enable page
fetch('/api/packets?format=table').then(res => res.text()).then(text => {
	document.getElementById('packets-header').insertAdjacentHTML('afterend', text)
})

async function deletePacket (name) {
	await fetch(`/api/packets/${name}`, { method: 'DELETE' })
	location.reload()
	console.log('Failed to delete packet')
}

async function editPacket (name) {
	const res = await fetch(`/api/packets/${name}?queryOnly`, { method: 'GET' })
	const queryString = await res.text()
	location.assign(`${WINDOW_URL.origin}?${queryString}`)
}

async function regeneratePackets () {
	const res = await fetch(`/api/regenerate`, { method: 'POST' })
	const text = await res.text()
	document.getElementById('regenerate').insertAdjacentHTML("afterend", text)
}

</script>

